# Contributing to WB-Toolbox

First off, thanks for your interest in contributing to this project! :tada:

The following is a set of guidelines for contributing to Whole-Body Toolbox. This project is developed at the Italian Institute of Technology and it is part of our [robotology](https://github.com/robotology) organization.

Keep in mind that the following are mostly guidelines, not strict rules. Use your best judgement and feel free to propose changes to this document in a pull request.

#### Table of contents

- [License](#license)
- [Code style](#code-style)
  - [C++](#c++)
  - [CMake](#cmake)
  - [Git](#git)
- [Documentation](#documentation)
- [Website](#website)
- [Policies](#policies)
  - [Versioning](#versioning)
  - [Deprecations](#deprecations)

## License

All files should contain a license heading:

```
Copyright (C) 2018 Istituto Italiano di Tecnologia (IIT)
All rights reserved.

This software may be modified and distributed under the terms of the
GNU Lesser General Public License v2.1 or any later version.
```

## Code Style

### C++

We enforce a project-wise C++ style based on [clang-format](/.clang-format). For accepting your PR, your code should be formatted accordingly. Most IDEs nowadays support this tool out-of-the-box and configuring it should be straightforward.

Furthermore:

- All files should use UNIX end of lines.
- Include only what you use. If you are unsure, use the [iwyu](https://github.com/include-what-you-use/include-what-you-use) tool.
- The [pimpl pattern](https://cpppatterns.com/patterns/pimpl.html) is recommended.
- Add an empty line between project, system headers, and `std` headers.
- Forward-declare classes into namespaces.
- Do not use `#pragma once`, use instead `#ifndef ... #define ... #endif` macro.
- The defines macros should have the `NS1_NS2_<CLASSNAME>_H` format.
- The final `#endif` should have a comment containing the closed `#ifndef`.
- When possible, use explicit declaration and explicit instantiation of templates.
- When not possible, use [three-files `-inl.h`](http://drake.mit.edu/cxx_inl.html) pattern approach.

Example:

```cpp
#ifndef WBT_BLOCK_JACOBIAN_H
#define WBT_BLOCK_JACOBIAN_H

#include "Jacobian.h"
#include "RobotInterface.h"
#include "Signal.h"

#include <iDynTree/EigenHelpers.h>
#include <iDynTree/SpatialMomentum.h>
#include <iDynTree/KinDynComputations.h>

#include <ostream>

namespace wbt {
    namespace block {
        class Jacobian;
    } // namespace block
} // namespace wbt

class wbt::block::Jacobian
{
...

#endif // WBT_BLOCK_JACOBIAN_H
```

### CMake

- 4 spaces indentation (no tabs).
- Lowercase comments, i.e. `if` instead `IF`.
- No spaces between commands and brakets and do not repeat the argument in the closing blocks, i.e. `if(FOO) ... else() ... endif()`.
- No whitespaces at the end of lines.
- One EOL at the end of the file.
- All files should use UNIX end of lines.

### Git

- Try to comply as much as possible to GitFlow branching model (no need to use external tools).
- Do not push merges generated by `git pull`. Always `pull --rebase`.
- Always check what you are pushing using some graphic tool (`qgit`, `gitg`, `gitk`, `sourcetree`, `gitkraken`).
- Keep commits small and do one and only one thing in each commit, which should be documented with optional but appreciated commit description.
- Use `rebase -i` and `amend` to rewrite your local history and keep it clean.
- Never force-push on the `master` and `devel` branches unless there is a very good reason to do it.

## Documentation

- All the new classes and methods of your PR should contain the doxygen documentation in their headers. For checking its render before pushing, proceed as follows:
   ```
   mkdir buildDox
   cd buildDox
   cmake -DWBT_BUILD_DOCS=ON ..
   make dox
   # If there are any errors, fix them.
   cd doc/doxygen/html
   python3 -m http.server
   # Browse to http://localhost:8000
   ```
- Your PR should add a changelog in the [doc/release](/doc/release) file of the [upcoming version](#versioning) (minor release if the PR targets `master`, major release if it targets `devel`).

## Website

Our website is based on the [mkdocs](https://github.com/mkdocs/mkdocs) framework and the [mkdocs-material](https://github.com/squidfunk/mkdocs-material) theme.

The easier way to modify a page of website is doing it directly from the website. In the top-right corner of every page, on the same line of the page title, you will find an pencil icon. If you click on the icon, the markdown file that creates the webpage opens in the GitHub web editor. Here you can modify the document and create a pull request.

If the edits you want to submit are not trivial, or if you want to check how the website will be rendered, you need to clone the repository and modify with your favourite text editor the files inside the [`doc/mkdocs/data`](/doc/mkdocs/data) folder. Afterwards, you can generate and browse a local website executing the following commands:

```
mkdir buildWebsite
cd buildWebsite
cmake -DWBT_BUILD_DOCS=ON ..
make mkdocs
# If there are any errors, fix them.
cd doc/mkdocs
python3 -m http.server
# Browse to http://localhost:8000
```

## Policies

## Versioning

Starting from `v5`, this project hosts only a blockfactory plugin library. All the public APIs have been moved to [robotology/blockfactory](https://github.com/robotology/blockfactory). The versioning policy is not anymore related to public APIs.

The next sections use the definition of **user code**: it represents all the functionalities that can be built with the `WBT` library. It includes Simulink models, autogenerated code from Simulink models, and C++ code that directly uses `WBT` as a C++ library.

#### Major releases, e.g. `v5`

- We use a fast rollout numbering, publishing a new major release every `devel` freeze. This happens when we decide that the amount of new features are worth a new release.
- Major releases may or may not break user code. Read [Deprecations](#deprecations) for further information.

#### Minor releases, e.g. `v5.1`

- Minor releases may contain hot-fixes applied directly to `master` (and then merged to `devel`).
- User code is preserved.

## Deprecations

Functions and classes which are marked as deprecated in one major release will be kept at least for another major release. This means that a deprecated class in version `v4` will still be present in version `v5`, but it might be deleted in version `v6`. This should give users an acceptable time buffer to update their models.
